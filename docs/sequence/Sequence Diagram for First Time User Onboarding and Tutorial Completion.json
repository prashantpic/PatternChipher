
{
  "mermaidDiagram": "sequenceDiagram\n    actor \"User\" as USER\n    participant \"GameClientApplication\" as REPOPATT001\n    participant \"UserInterfaceEndpoints\" as REPOPATT003\n    participant \"LocalPersistenceEndpoints\" as REPOPATT004\n    participant \"GameplayLogicEndpoints\" as REPOPATT002\n    participant \"BackendServiceFacade\" as REPOPATT005\n    participant \"AuthenticationServiceEndpoints\" as REPOPATT006\n    participant \"RemoteConfigEndpoints\" as REPOPATT009\n    \n    USER->>REPOPATT001: 1. launchApp()\n    activate REPOPATT001\n    REPOPATT001->>REPOPATT004: 2. loadProfile()\n    activate REPOPATT004\n    note over REPOPATT004: On first launch, no local profile exists. Triggers anonymous sign-in flow (NFR-R-002)\n    REPOPATT004-->>REPOPATT001: return null (profile not found)\n    deactivate REPOPATT004\n    REPOPATT001->>REPOPATT003: 3. showLoadingScreen()\n    activate REPOPATT003\n    deactivate REPOPATT003\n    REPOPATT001->>REPOPATT005: 4. signInAnonymously()\n    activate REPOPATT005\n    alt sign-in success\n        REPOPATT005->>REPOPATT006: 4.1. requestAnonymousSignIn()\n        activate REPOPATT006\n        REPOPATT006-->>REPOPATT005: onSuccess(firebaseUser)\n        deactivate REPOPATT006\n        REPOPATT005-->>REPOPATT001: 5. onSignInSuccess(firebaseUser)\n        deactivate REPOPATT005\n        REPOPATT001->>REPOPATT005: 6. fetchRemoteConfig()\n        activate REPOPATT005\n        alt config fetch success\n            REPOPATT005->>REPOPATT009: 6.1. fetchAndActivate()\n            activate REPOPATT009\n            REPOPATT009-->>REPOPATT005: onSuccess(configValues)\n            deactivate REPOPATT009\n            REPOPATT005-->>REPOPATT001: 7. onConfigFetched(config)\n            deactivate REPOPATT005\n            REPOPATT001->>REPOPATT003: 8. startTutorial()\n            activate REPOPATT003\n            deactivate REPOPATT003\n            loop 9. Loop: Tutorial Interactions\n                USER->>REPOPATT003: 9.1. performAction(move)\n                activate REPOPATT003\n                REPOPATT003->>REPOPATT001: 9.2. processUserAction(move)\n                activate REPOPATT001\n                REPOPATT001->>REPOPATT002: 9.3. validateTutorialMove(move)\n                activate REPOPATT002\n                REPOPATT002-->>REPOPATT001: return {isValid, isComplete}\n                deactivate REPOPATT002\n                REPOPATT001->>REPOPATT003: 9.4. updateTutorialView(result)\n                deactivate REPOPATT001\n                deactivate REPOPATT003\n            end\n            REPOPATT001->>REPOPATT004: 10. createAndSaveProfile(firebaseUid, tutorialComplete: true)\n            activate REPOPATT004\n            note over REPOPATT004: Player profile saved locally as JSON file with Firebase UID for cloud identity linking (DM-001, FR-ONL-003)\n            REPOPATT004->>REPOPATT004: 10.1. serializeProfileToJSON()\n            REPOPATT004->>REPOPATT004: 10.2. writeFileToDisk(jsonData)\n            REPOPATT004-->>REPOPATT001: return saveSuccess\n            deactivate REPOPATT004\n            REPOPATT001->>REPOPATT003: 11. transitionToLevelSelect()\n            activate REPOPATT003\n            deactivate REPOPATT003\n        else config fetch fails\n            REPOPATT005-->>REPOPATT001: onConfigFetchFailed(error)\n            deactivate REPOPATT005\n            note right of REPOPATT001: Alternative Path: Show error screen and block progress\n            REPOPATT001->>REPOPATT003: showErrorScreen(\"Config fetch failed\")\n        end\n    else sign-in fails\n        REPOPATT005-->>REPOPATT001: onSignInFailed(error)\n        deactivate REPOPATT005\n        note right of REPOPATT001: Alternative Path: Show error screen and block progress\n        REPOPATT001->>REPOPATT003: showErrorScreen(\"Sign-in failed\")\n    end\n    deactivate REPOPATT001"
}
